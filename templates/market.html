{% extends "base.html" %}

{% block content %}
<section class="analytics-dashboard">
    <!-- Live Update Controls -->
    <div class="live-controls">
        <div class="live-indicator-wrapper">
            <span id="liveIndicator" class="live-indicator"></span>
            <span class="live-text">Live Updates</span>
        </div>
        <div class="last-update">
            Last updated: <span id="lastUpdateTime">--:--:-- --</span>
        </div>
        <button id="toggleUpdateBtn" class="toggle-update-btn" onclick="toggleUpdates()">‚è∏ Pause Updates</button>
    </div>

    <h1 style="margin-bottom: 2rem; font-size: 2rem; font-weight: 700;">üìä Analytics Dashboard</h1>

    <div class="dashboard-layout">
        <!-- Hero: Market Sentiment -->
        <div class="card chart-card chart-hero">
            <h2>Market Sentiment</h2>
            <div class="chart-container-large">
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>

        <!-- Row 1: Sector Analysis -->
        <div class="chart-grid-2">
            <div class="card chart-card">
                <h2>Sector Avg Price</h2>
                <div class="chart-container-medium">
                    <canvas id="sectorPriceChart"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <h2>Sector Volume Share</h2>
                <div class="chart-container-medium">
                    <canvas id="sectorVolumeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Row 2: Top Performers (Price & Volume) -->
        <div class="chart-grid-2">
            <div class="card chart-card">
                <h2>Top 5 - Highest Price</h2>
                <div class="chart-container-medium">
                    <canvas id="topPriceChart"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <h2>Top 5 - Most Traded</h2>
                <div class="chart-container-medium">
                    <canvas id="topVolumeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Hero: Risk Analysis (Needs space for scatter plot) -->
        <div class="card chart-card chart-hero">
            <h2>Risk Analysis (Volatility vs Price)</h2>
            <div class="chart-container-large">
                <canvas id="riskScatterChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Top Performers List -->
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h2>Top Performers</h2>
            <select id="rankingCriteria" onchange="fetchTopK()">
                <option value="price">Price</option>
                <option value="volume">Volume</option>
                <option value="score">Priority Score</option>
            </select>
        </div>
        <ul id="topKList" class="ranking-list">
            <!-- Populated by JS -->
        </ul>
    </div>
</section>
{% endblock %}